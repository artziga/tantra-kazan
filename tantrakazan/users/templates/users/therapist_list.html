{% extends 'main/base.html' %}
{% load static %}

{% block content %}
   <section class="layout_padding layout_padding-left">
       {% include 'users/filter_form.html' %}
       <a href="{% url 'users:therapists' %}"><button type="submit">Сбросить фильтр</button></a>
       <a href="{% url 'users:therapists_on_map' %}?{{ request.GET.urlencode }}">Показать на карте</a>
{% for therapist in therapists %}
        {% include 'users/profile_card2.html' %}
          {% endfor %}
  </section>
{% endblock content %}


{% block scripts %}

<script>
$(document).ready(function () {
  $(".bookmark-form").submit(function (event) {
    event.preventDefault();

    var form = $(this);
    var therapistId = form.attr("id").split("-")[2];
    var url = form.attr("action");

    $.ajax({
      type: "POST",
      url: url,
      data: form.serialize(),
      dataType: "json",
      success: function (data) {
        // Обновите отображаемые результаты на странице
        $("#bookmark-data-" + therapistId).val(data.result);
        $("#bookmark-count-" + therapistId).text(data.count); // Обновление количества

        // Обновите изображение на кнопке
        var button = $("#bookmark-button-" + therapistId);
        if (data.result) {
          button.attr("src", "{% static 'main/images/like-on.svg' %}");
          button.attr("alt", "Удалить из закладок");
        } else {
          button.attr("src", "{% static 'main/images/like-off.svg' %}");
          button.attr("alt", "Добавить в закладки");
        }
      },
      error: function (xhr, textStatus, errorThrown) {
        // Обработка ошибки, если не удалось отправить запрос
        console.error("Произошла ошибка: " + errorThrown);
      }
    });
  });
});
</script>

{% endblock scripts %}
